document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("process-text");e?e.addEventListener("click",(async()=>{console.log("🟢 Button clicked! Running text extraction & screenshot capture...");try{const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e)return void console.error("❌ No active tab found.");console.log(`📌 Using active tab ID: ${e.id}`),await chrome.scripting.executeScript({target:{tabId:e.id},files:["dist/contentScript.bundle.js"]}),console.log("✅ Content script injected successfully."),await new Promise(((o,t)=>{chrome.tabs.sendMessage(e.id,{type:"RUN_LOGIC"},(e=>{chrome.runtime.lastError?(console.error("❌ AI error:",chrome.runtime.lastError.message),t(chrome.runtime.lastError.message)):e&&"done"===e.status?(console.log("🤖 AI Response:",e.aiResponse),o(e.aiResponse)):(console.error("❌ Unexpected AI response:",e),t("Unexpected AI response"))}))})),chrome.runtime.sendMessage({type:"START_FULL_PAGE_CAPTURE",tabId:e.id},(e=>{console.log("📥 Full-page capture started:",e)}))}catch(e){console.error("❌ Error:",e)}})):console.error("❌ Button not found! Check popup.html.")})),chrome.runtime.onMessage.addListener(((e,o,t)=>{"SCREENSHOTS_READY"===e.type&&(console.log("📸 Full-page screenshots received:",e.images),e.images.forEach(((e,o)=>{console.log(`🖼️ Screenshot #${o+1}:`,e)})),t({status:"received"}))}));